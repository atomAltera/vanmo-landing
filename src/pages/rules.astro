---
import yaml from 'js-yaml';
import { readFileSync } from 'fs';
import BaseLayout from '../layouts/BaseLayout.astro';

const pagesData = yaml.load(readFileSync('src/data/pages.yaml', 'utf8')) as {
  rules: {
    title: string;
    description: string;
  };
};
---

<BaseLayout title={pagesData.rules.title} description={pagesData.rules.description}>
  <section class="section-edge py-16 md:py-20">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">

      <!-- Header -->
      <div class="text-center mb-12">
        <p class="kicker mb-2">Регламент</p>
        <h1 class="text-4xl md:text-5xl font-display text-white">
          Правила спортивной мафии
        </h1>
        <p class="text-lg text-gray-300 mt-4">
          Официальные правила игры в спортивную мафию для турниров и рейтинговых игр.
        </p>
      </div>

      <!-- Table of Contents -->
      <nav class="glass-card rounded-2xl p-6 mb-10">
        <p class="text-sm text-gray-400 uppercase tracking-wide mb-4">Содержание</p>
        <ol class="grid gap-2 text-gray-300">
          <li><a href="#overview" class="hover:text-white transition-colors">1. Общие положения</a></li>
          <li><a href="#roles" class="hover:text-white transition-colors">2. Роли</a></li>
          <li><a href="#night" class="hover:text-white transition-colors">3. Ночная фаза</a></li>
          <li><a href="#day" class="hover:text-white transition-colors">4. Дневное обсуждение</a></li>
          <li><a href="#voting" class="hover:text-white transition-colors">5. Голосование</a></li>
          <li><a href="#tiebreaker" class="hover:text-white transition-colors">6. Перестрелка</a></li>
          <li><a href="#endgame" class="hover:text-white transition-colors">7. Условия победы</a></li>
        </ol>
      </nav>

      <!-- Sections -->
      <div class="space-y-12">

        <!-- 1. Overview -->
        <article id="overview" class="scroll-mt-24">
          <h2 class="text-2xl md:text-3xl font-display text-white mb-6 flex items-center gap-3">
            <span class="flex-shrink-0 w-10 h-10 border border-red-500/60 text-red-100 rounded-full flex items-center justify-center text-sm font-bold">01</span>
            Общие положения
          </h2>
          <div class="glass-card rounded-2xl p-6 md:p-8 space-y-4 text-gray-300">
            <p>
              Спортивная мафия — командная психологическая игра. Игроки делятся на две команды: мафию и мирных жителей. Команды не знают точный состав друг друга.
            </p>
            <p>
              <strong class="text-white">Состав игры:</strong> ровно 10 игроков — 3 мафии и 7 мирных жителей.
            </p>
            <p>
              <strong class="text-white">Цель мафии:</strong> добиться равенства численности с мирными жителями (3:3, 2:2 или 1:1).
            </p>
            <p>
              <strong class="text-white">Цель мирных:</strong> вычислить и устранить всех членов мафии.
            </p>
            <p>
              Игра ведётся под управлением ведущего. Его решения обязательны для всех участников.
            </p>
          </div>
        </article>

        <!-- 2. Roles -->
        <article id="roles" class="scroll-mt-24">
          <h2 class="text-2xl md:text-3xl font-display text-white mb-6 flex items-center gap-3">
            <span class="flex-shrink-0 w-10 h-10 border border-red-500/60 text-red-100 rounded-full flex items-center justify-center text-sm font-bold">02</span>
            Роли
          </h2>

          <div class="space-y-4">
            <!-- Mafia Team -->
            <div class="glass-card rounded-2xl p-6 md:p-8">
              <h3 class="text-xl font-semibold text-red-400 mb-4">Команда мафии (3 игрока)</h3>
              <div class="space-y-4 text-gray-300">
                <div>
                  <p class="text-white font-medium">Рядовые мафиози (2 игрока)</p>
                  <p>Знают всех членов своей команды. Ночью совместно выбирают жертву.</p>
                </div>
                <div>
                  <p class="text-white font-medium">Дон мафии (1 игрок)</p>
                  <p>Глава мафии. Помимо участия в ночном убийстве, каждую ночь проверяет одного игрока на наличие роли Шерифа. Ведущий отвечает «да» или «нет».</p>
                </div>
              </div>
            </div>

            <!-- Civilian Team -->
            <div class="glass-card rounded-2xl p-6 md:p-8">
              <h3 class="text-xl font-semibold text-blue-400 mb-4">Команда мирных жителей (7 игроков)</h3>
              <div class="space-y-4 text-gray-300">
                <div>
                  <p class="text-white font-medium">Мирные жители (6 игроков)</p>
                  <p>Не имеют специальных способностей. Голосуют и обсуждают, чтобы вычислить мафию.</p>
                </div>
                <div>
                  <p class="text-white font-medium">Шериф (1 игрок)</p>
                  <p>Каждую ночь проверяет одного игрока. Ведущий сообщает принадлежность проверяемого: мафия или мирный житель.</p>
                </div>
              </div>
            </div>

            <p class="text-gray-400 text-sm">
              В спортивной мафии используются только эти роли. Дополнительных ролей (доктор, маньяк и др.) нет.
            </p>
          </div>
        </article>

        <!-- 3. Night Phase -->
        <article id="night" class="scroll-mt-24">
          <h2 class="text-2xl md:text-3xl font-display text-white mb-6 flex items-center gap-3">
            <span class="flex-shrink-0 w-10 h-10 border border-red-500/60 text-red-100 rounded-full flex items-center justify-center text-sm font-bold">03</span>
            Ночная фаза
          </h2>
          <div class="glass-card rounded-2xl p-6 md:p-8 space-y-4 text-gray-300">
            <p>
              Ночью все игроки закрывают глаза. Ведущий поочерёдно вызывает роли.
            </p>

            <div class="space-y-3">
              <div class="border-l-2 border-red-500/50 pl-4">
                <p class="text-white font-medium">Мафия просыпается</p>
                <p>Все три мафиози открывают глаза, видят друг друга и молча указывают на игрока, которого хотят убить. Можно намеренно не убивать никого («пустой выстрел»).</p>
              </div>

              <div class="border-l-2 border-red-500/50 pl-4">
                <p class="text-white font-medium">Дон просыпается</p>
                <p>Дон (если жив) указывает на игрока для проверки на Шерифа. Ведущий показывает «да» (это Шериф) или «нет».</p>
              </div>

              <div class="border-l-2 border-blue-500/50 pl-4">
                <p class="text-white font-medium">Шериф просыпается</p>
                <p>Шериф (если жив) указывает на игрока для проверки. Ведущий показывает принадлежность: мафия (красная карта) или мирный (чёрная карта).</p>
              </div>
            </div>

            <p class="text-gray-400 text-sm mt-4">
              Ведущий всегда объявляет пробуждение Дона и Шерифа, даже если эти роли уже выбыли из игры. Это сохраняет информационную симметрию.
            </p>
          </div>
        </article>

        <!-- 4. Day Discussion -->
        <article id="day" class="scroll-mt-24">
          <h2 class="text-2xl md:text-3xl font-display text-white mb-6 flex items-center gap-3">
            <span class="flex-shrink-0 w-10 h-10 border border-red-500/60 text-red-100 rounded-full flex items-center justify-center text-sm font-bold">04</span>
            Дневное обсуждение
          </h2>
          <div class="glass-card rounded-2xl p-6 md:p-8 space-y-4 text-gray-300">
            <p>
              Утром ведущий объявляет, кто был убит ночью (если был выстрел). Убитый игрок покидает игру без права голоса и комментариев.
            </p>

            <div class="space-y-3">
              <div>
                <p class="text-white font-medium">Порядок выступлений</p>
                <p>Игроки выступают строго по очереди, начиная с определённого номера. Каждому отводится ровно 1 минута.</p>
              </div>

              <div>
                <p class="text-white font-medium">Выдвижение кандидатур</p>
                <p>Во время своей речи игрок может выдвинуть <strong class="text-white">только одного</strong> кандидата на голосование или воздержаться от выдвижения. Выдвинуть самого себя нельзя.</p>
              </div>

              <div>
                <p class="text-white font-medium">День 0</p>
                <p>Первый день игры (до первой ночи). Игроки знакомятся и формируют первые версии. Если выдвинут только один кандидат — голосование не проводится, игра переходит в ночь.</p>
              </div>
            </div>
          </div>
        </article>

        <!-- 5. Voting -->
        <article id="voting" class="scroll-mt-24">
          <h2 class="text-2xl md:text-3xl font-display text-white mb-6 flex items-center gap-3">
            <span class="flex-shrink-0 w-10 h-10 border border-red-500/60 text-red-100 rounded-full flex items-center justify-center text-sm font-bold">05</span>
            Голосование
          </h2>
          <div class="glass-card rounded-2xl p-6 md:p-8 space-y-4 text-gray-300">
            <p>
              После завершения всех выступлений проводится голосование по выдвинутым кандидатам.
            </p>

            <div class="space-y-3">
              <div>
                <p class="text-white font-medium">Процедура голосования</p>
                <p>Голосование открытое. Кандидаты голосуются в порядке выдвижения. Каждый игрок обязан проголосовать ровно один раз.</p>
              </div>

              <div>
                <p class="text-white font-medium">Обязательное голосование</p>
                <p>Если игрок не проголосовал ни за одного кандидата, его голос автоматически засчитывается за последнего в списке.</p>
              </div>

              <div>
                <p class="text-white font-medium">Единственный кандидат (с Дня 1)</p>
                <p>Если выдвинут только один кандидат — он выбывает автоматически без голосования.</p>
              </div>

              <div>
                <p class="text-white font-medium">Результат</p>
                <p>Выбывает игрок, набравший наибольшее число голосов. При равенстве голосов назначается перестрелка.</p>
              </div>
            </div>
          </div>
        </article>

        <!-- 6. Tiebreaker -->
        <article id="tiebreaker" class="scroll-mt-24">
          <h2 class="text-2xl md:text-3xl font-display text-white mb-6 flex items-center gap-3">
            <span class="flex-shrink-0 w-10 h-10 border border-red-500/60 text-red-100 rounded-full flex items-center justify-center text-sm font-bold">06</span>
            Перестрелка
          </h2>
          <div class="glass-card rounded-2xl p-6 md:p-8 space-y-4 text-gray-300">
            <p>
              Перестрелка проводится при равенстве голосов между двумя или более кандидатами.
            </p>

            <div class="space-y-3">
              <div>
                <p class="text-white font-medium">Оправдательная речь</p>
                <p>Каждый участник перестрелки получает 30 секунд для оправдательной речи.</p>
              </div>

              <div>
                <p class="text-white font-medium">Повторное голосование</p>
                <p>После речей проводится повторное голосование только между участниками перестрелки.</p>
              </div>

              <div>
                <p class="text-white font-medium">Повторное равенство</p>
                <p>Если голоса снова разделились поровну, возможны два исхода:</p>
                <ul class="list-disc list-inside ml-4 mt-2 space-y-1">
                  <li><strong class="text-white">Стол 9–10 игроков:</strong> выбывают все участники перестрелки</li>
                  <li><strong class="text-white">Стол 8 и менее игроков:</strong> никто не выбывает, игра переходит в ночь</li>
                </ul>
              </div>
            </div>
          </div>
        </article>

        <!-- 7. Endgame -->
        <article id="endgame" class="scroll-mt-24">
          <h2 class="text-2xl md:text-3xl font-display text-white mb-6 flex items-center gap-3">
            <span class="flex-shrink-0 w-10 h-10 border border-red-500/60 text-red-100 rounded-full flex items-center justify-center text-sm font-bold">07</span>
            Условия победы
          </h2>
          <div class="glass-card rounded-2xl p-6 md:p-8 space-y-4 text-gray-300">
            <div class="grid md:grid-cols-2 gap-4">
              <div class="border border-red-500/30 rounded-xl p-4">
                <p class="text-red-400 font-semibold mb-2">Победа мафии</p>
                <p>Мафия побеждает, когда количество мафии сравнялось с количеством мирных жителей:</p>
                <ul class="list-disc list-inside mt-2 space-y-1 text-sm">
                  <li>3 мафии — 3 мирных</li>
                  <li>2 мафии — 2 мирных</li>
                  <li>1 мафия — 1 мирный</li>
                </ul>
              </div>

              <div class="border border-blue-500/30 rounded-xl p-4">
                <p class="text-blue-400 font-semibold mb-2">Победа мирных</p>
                <p>Мирные жители побеждают, когда все три мафиози выбыли из игры.</p>
              </div>
            </div>

            <div>
              <p class="text-white font-medium">Критические ситуации</p>
              <ul class="list-disc list-inside mt-2 space-y-1">
                <li><strong class="text-white">3 мафии, 4 мирных (7 игроков):</strong> если днём выбывает мирный — победа мафии</li>
                <li><strong class="text-white">2 мафии, 3 мирных (5 игроков):</strong> если днём выбывает мирный — победа мафии</li>
                <li><strong class="text-white">1 мафия, 2 мирных (3 игрока):</strong> если днём выбывает мирный — победа мафии</li>
              </ul>
            </div>

            <p class="text-gray-400 text-sm">
              Победа фиксируется немедленно при достижении условия, независимо от фазы игры (день или ночь).
            </p>
          </div>
        </article>

      </div>

    </div>
  </section>
</BaseLayout>
