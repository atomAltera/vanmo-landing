---
import yaml from 'js-yaml';
import { readFileSync } from 'fs';
import BaseLayout from '../layouts/BaseLayout.astro';

const pagesData = yaml.load(readFileSync('src/data/pages.yaml', 'utf8')) as {
  rules: {
    title: string;
    description: string;
  };
};
---

<BaseLayout title={pagesData.rules.title} description={pagesData.rules.description}>
  <section class="section-edge section-padding rules-header">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <p class="kicker mb-3">Регламент</p>
      <h1 class="text-4xl md:text-5xl lg:text-6xl font-display text-white mb-6">
        Правила спортивной мафии
      </h1>
      <p class="text-lg md:text-xl text-gray-300 max-w-2xl leading-relaxed">
        Официальные правила игры в спортивную мафию для турниров и рейтинговых игр.
      </p>
    </div>
  </section>

  <section class="section-edge py-12 md:py-16">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="space-y-16">

        <!-- 1. Overview -->
        <article id="overview" class="scroll-mt-24">
          <div class="rule-header">
            <span class="rule-index">01</span>
            <h2 class="text-2xl md:text-3xl font-display text-white">Общие положения</h2>
          </div>
          <div class="rule-content">
            <p>
              Спортивная мафия — командная психологическая игра. Игроки делятся на две команды: мафию и мирных жителей. Команды не знают точный состав друг друга.
            </p>
            <p>
              <strong class="text-white">Состав игры:</strong> ровно 10 игроков — 3 мафии и 7 мирных жителей.
            </p>
            <p>
              <strong class="text-white">Цель мафии:</strong> добиться равенства численности с мирными жителями (3:3, 2:2 или 1:1).
            </p>
            <p>
              <strong class="text-white">Цель мирных:</strong> вычислить и устранить всех членов мафии.
            </p>
            <p>
              Игра ведётся под управлением ведущего. Его решения обязательны для всех участников.
            </p>
          </div>
        </article>

        <!-- 2. Roles -->
        <article id="roles" class="scroll-mt-24">
          <div class="rule-header">
            <span class="rule-index">02</span>
            <h2 class="text-2xl md:text-3xl font-display text-white">Роли</h2>
          </div>

          <div class="space-y-6 mt-6">
            <!-- Mafia Team -->
            <div class="team-card team-mafia">
              <h3 class="text-xl font-display text-white mb-4">Команда мафии <span class="text-gray-500 font-normal text-base">(3 игрока)</span></h3>
              <div class="space-y-4 text-gray-300">
                <div>
                  <p class="text-white font-medium">Рядовые мафиози (2 игрока)</p>
                  <p>Знают всех членов своей команды. Ночью совместно выбирают жертву.</p>
                </div>
                <div>
                  <p class="text-white font-medium">Дон мафии (1 игрок)</p>
                  <p>Глава мафии. Помимо участия в ночном убийстве, каждую ночь проверяет одного игрока на наличие роли Шерифа.</p>
                </div>
              </div>
            </div>

            <!-- Civilian Team -->
            <div class="team-card team-civilian">
              <h3 class="text-xl font-display text-white mb-4">Команда мирных жителей <span class="text-gray-500 font-normal text-base">(7 игроков)</span></h3>
              <div class="space-y-4 text-gray-300">
                <div>
                  <p class="text-white font-medium">Мирные жители (6 игроков)</p>
                  <p>Не имеют специальных способностей. Голосуют и обсуждают, чтобы вычислить мафию.</p>
                </div>
                <div>
                  <p class="text-white font-medium">Шериф (1 игрок)</p>
                  <p>Каждую ночь проверяет одного игрока. Ведущий сообщает принадлежность проверяемого: мафия или мирный житель.</p>
                </div>
              </div>
            </div>

            <p class="text-gray-500 text-sm">
              В спортивной мафии используются только эти роли. Дополнительных ролей (доктор, маньяк и др.) нет.
            </p>
          </div>
        </article>

        <!-- 3. Night Phase -->
        <article id="night" class="scroll-mt-24">
          <div class="rule-header">
            <span class="rule-index">03</span>
            <h2 class="text-2xl md:text-3xl font-display text-white">Ночная фаза</h2>
          </div>
          <div class="rule-content">
            <p>
              Ночью все игроки закрывают глаза. Ведущий поочерёдно вызывает роли.
            </p>

            <div class="space-y-4 mt-6">
              <div class="phase-item phase-mafia">
                <p class="text-white font-medium">Мафия просыпается</p>
                <p>Все три мафиози открывают глаза, видят друг друга и молча указывают на игрока, которого хотят убить.</p>
              </div>

              <div class="phase-item phase-mafia">
                <p class="text-white font-medium">Дон просыпается</p>
                <p>Дон (если жив) указывает на игрока для проверки на Шерифа. Ведущий показывает «да» или «нет».</p>
              </div>

              <div class="phase-item phase-civilian">
                <p class="text-white font-medium">Шериф просыпается</p>
                <p>Шериф (если жив) указывает на игрока для проверки. Ведущий показывает принадлежность: мафия или мирный.</p>
              </div>
            </div>

            <p class="text-gray-500 text-sm mt-6">
              Ведущий всегда объявляет пробуждение Дона и Шерифа, даже если эти роли уже выбыли из игры.
            </p>
          </div>
        </article>

        <!-- 4. Day Discussion -->
        <article id="day" class="scroll-mt-24">
          <div class="rule-header">
            <span class="rule-index">04</span>
            <h2 class="text-2xl md:text-3xl font-display text-white">Дневное обсуждение</h2>
          </div>
          <div class="rule-content">
            <p>
              Утром ведущий объявляет, кто был убит ночью. Убитый игрок покидает игру без права голоса и комментариев.
            </p>

            <div class="space-y-4 mt-6">
              <div>
                <p class="text-white font-medium">Порядок выступлений</p>
                <p>Игроки выступают строго по очереди. Каждому отводится ровно 1 минута.</p>
              </div>

              <div>
                <p class="text-white font-medium">Выдвижение кандидатур</p>
                <p>Во время своей речи игрок может выдвинуть <strong class="text-white">только одного</strong> кандидата на голосование. Выдвинуть самого себя нельзя.</p>
              </div>

              <div>
                <p class="text-white font-medium">День 0</p>
                <p>Первый день игры (до первой ночи). Игроки знакомятся и формируют первые версии.</p>
              </div>
            </div>
          </div>
        </article>

        <!-- 5. Voting -->
        <article id="voting" class="scroll-mt-24">
          <div class="rule-header">
            <span class="rule-index">05</span>
            <h2 class="text-2xl md:text-3xl font-display text-white">Голосование</h2>
          </div>
          <div class="rule-content">
            <p>
              После завершения всех выступлений проводится голосование по выдвинутым кандидатам.
            </p>

            <div class="space-y-4 mt-6">
              <div>
                <p class="text-white font-medium">Процедура голосования</p>
                <p>Голосование открытое. Кандидаты голосуются в порядке выдвижения. Каждый игрок обязан проголосовать ровно один раз.</p>
              </div>

              <div>
                <p class="text-white font-medium">Обязательное голосование</p>
                <p>Если игрок не проголосовал — его голос засчитывается за последнего в списке.</p>
              </div>

              <div>
                <p class="text-white font-medium">Результат</p>
                <p>Выбывает игрок, набравший наибольшее число голосов. При равенстве голосов — перестрелка.</p>
              </div>
            </div>
          </div>
        </article>

        <!-- 6. Tiebreaker -->
        <article id="tiebreaker" class="scroll-mt-24">
          <div class="rule-header">
            <span class="rule-index">06</span>
            <h2 class="text-2xl md:text-3xl font-display text-white">Перестрелка</h2>
          </div>
          <div class="rule-content">
            <p>
              Перестрелка проводится при равенстве голосов между двумя или более кандидатами.
            </p>

            <div class="space-y-4 mt-6">
              <div>
                <p class="text-white font-medium">Оправдательная речь</p>
                <p>Каждый участник перестрелки получает 30 секунд для оправдательной речи.</p>
              </div>

              <div>
                <p class="text-white font-medium">Повторное равенство</p>
                <p>Если голоса снова поровну:</p>
                <ul class="list-none mt-2 space-y-1 text-gray-400">
                  <li>• <span class="text-gray-300">9–10 игроков:</span> выбывают все участники перестрелки</li>
                  <li>• <span class="text-gray-300">8 и менее:</span> никто не выбывает, игра переходит в ночь</li>
                </ul>
              </div>
            </div>
          </div>
        </article>

        <!-- 7. Endgame -->
        <article id="endgame" class="scroll-mt-24">
          <div class="rule-header">
            <span class="rule-index">07</span>
            <h2 class="text-2xl md:text-3xl font-display text-white">Условия победы</h2>
          </div>
          <div class="rule-content">
            <div class="grid md:grid-cols-2 gap-6 mt-6">
              <div class="win-card win-mafia">
                <p class="text-blue-400 font-display text-xl mb-3">Победа мафии</p>
                <p class="text-gray-300">Количество мафии сравнялось с мирными:</p>
                <p class="text-gray-500 text-sm mt-2">3:3 • 2:2 • 1:1</p>
              </div>

              <div class="win-card win-civilian">
                <p class="text-red-400 font-display text-xl mb-3">Победа мирных</p>
                <p class="text-gray-300">Все три мафиози выбыли из игры.</p>
              </div>
            </div>

            <p class="text-gray-500 text-sm mt-6">
              Победа фиксируется немедленно при достижении условия, независимо от фазы игры.
            </p>
          </div>
        </article>

      </div>
    </div>
  </section>
</BaseLayout>

<style>
  .rules-header {
    background: linear-gradient(180deg, rgba(12, 12, 12, 0.6), rgba(0, 0, 0, 0));
  }

  .rules-header.section-edge::after {
    opacity: 0.3;
  }

  .rule-header {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 1rem;
    align-items: center;
    margin-bottom: 1.5rem;
  }

  .rule-index {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 9999px;
    background: rgba(227, 67, 67, 0.12);
    color: rgba(255, 255, 255, 0.85);
    font-size: 0.85rem;
    font-weight: 600;
  }

  .rule-content {
    color: #c7c7c7;
    line-height: 1.75;
  }

  .rule-content p {
    margin-bottom: 1rem;
  }

  .rule-content p:last-child {
    margin-bottom: 0;
  }

  .team-card {
    padding: 1.5rem;
    border-radius: 1rem;
    background: rgba(255, 255, 255, 0.02);
  }

  .team-mafia {
    border-left: 3px solid rgba(96, 165, 250, 0.4);
  }

  .team-civilian {
    border-left: 3px solid rgba(248, 113, 113, 0.4);
  }

  .phase-item {
    padding-left: 1rem;
    border-left: 2px solid rgba(255, 255, 255, 0.1);
    color: #c7c7c7;
  }

  .phase-mafia {
    border-left-color: rgba(96, 165, 250, 0.35);
  }

  .phase-civilian {
    border-left-color: rgba(248, 113, 113, 0.35);
  }

  .win-card {
    padding: 1.25rem;
    border-radius: 0.75rem;
    background: rgba(255, 255, 255, 0.02);
  }

  .win-mafia {
    border-left: 3px solid rgba(96, 165, 250, 0.4);
  }

  .win-civilian {
    border-left: 3px solid rgba(248, 113, 113, 0.4);
  }
</style>
