---
import yaml from 'js-yaml';
import { readFileSync } from 'fs';
import BaseLayout from '../layouts/BaseLayout.astro';

const pagesData = yaml.load(readFileSync('src/data/pages.yaml', 'utf8')) as {
  rules: {
    title: string;
    description: string;
  };
};
---

<BaseLayout title={pagesData.rules.title} description={pagesData.rules.description}>
  <section class="section-edge section-padding rules-header">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <p class="kicker mb-3">Регламент</p>
      <h1 class="text-4xl md:text-5xl lg:text-6xl font-display text-white mb-6">
        Правила спортивной мафии
      </h1>
      <p class="text-lg md:text-xl text-gray-300 max-w-2xl leading-relaxed">
        Краткое руководство по официальным правилам. Только то, что нужно новичкам, чтобы уверенно сыграть первую игру.
      </p>
    </div>
  </section>

  <section class="section-edge py-12 md:py-16">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="space-y-16">

        <!-- 0. Quick Start -->
        <article id="quick-start" class="scroll-mt-24">
          <div class="rule-header">
            <span class="rule-index">00</span>
            <h2 class="text-2xl md:text-3xl font-display text-white">Быстрый старт</h2>
          </div>
          <div class="rule-content">
            <p>Коротко о том, как идёт игра:</p>
            <ol class="list-decimal pl-5 space-y-2">
              <li>Игроки получают роли. Игра начинается с ночи.</li>
              <li>Ночью “чёрные” договариваются между собой. Дон и Шериф получают свои проверки.</li>
              <li>Утром объявляют выбывшего. Он говорит последнее слово 1 минуту.</li>
              <li>Днём все по очереди говорят по 1 минуте и называют одного кандидата на голосование.</li>
              <li>Голосование открытое. Выбывает игрок с большинством голосов.</li>
              <li>Дальше ночь и день чередуются до победы одной команды.</li>
            </ol>
          </div>
        </article>

        <!-- 1. Overview -->
        <article id="overview" class="scroll-mt-24">
          <div class="rule-header">
            <span class="rule-index">01</span>
            <h2 class="text-2xl md:text-3xl font-display text-white">Общие положения</h2>
          </div>
          <div class="rule-content">
            <p>
              Спортивная мафия — командная психологическая игра. 10 игроков случайно получают роли и делятся на две команды: “красные” (мирные) и “чёрные” (мафия). Команды не знают точный состав друг друга.
            </p>
            <p>
              <strong class="text-white">Состав игры:</strong> 7 “красных” карт (включая Шерифа) и 3 “чёрных” (включая Дона).
            </p>
            <p>
              Игра идёт в двух фазах: “день” (обсуждение и голосование) и “ночь” (действия ролей).
            </p>
            <p>
              <strong class="text-white">Цель мафии:</strong> добиться равенства численности с мирными жителями или преимущества “чёрных”.
            </p>
            <p>
              <strong class="text-white">Цель мирных:</strong> вычислить и устранить всех членов мафии.
            </p>
            <p>
              Игра проходит под управлением Судьи (ведущего). Он объявляет фазы, следит за порядком и фиксирует результаты.
            </p>
          </div>
        </article>

        <!-- 2. Roles -->
        <article id="roles" class="scroll-mt-24">
          <div class="rule-header">
            <span class="rule-index">02</span>
            <h2 class="text-2xl md:text-3xl font-display text-white">Роли</h2>
          </div>

          <div class="space-y-6 mt-6">
            <!-- Mafia Team -->
            <div class="team-card team-mafia">
              <h3 class="text-xl font-display text-white mb-4">Команда мафии <span class="text-gray-500 font-normal text-base">(3 игрока)</span></h3>
              <div class="space-y-4 text-gray-300">
                <div>
                  <p class="text-white font-medium">Рядовые мафиози (2 игрока)</p>
                  <p>Знают своих союзников. Ночью участвуют в выборе жертвы вместе с Доном.</p>
                </div>
                <div>
                  <p class="text-white font-medium">Дон мафии (1 игрок)</p>
                  <p>Глава мафии. Помимо участия в “стрельбе”, ночью ищет Шерифа.</p>
                </div>
              </div>
            </div>

            <!-- Civilian Team -->
            <div class="team-card team-civilian">
              <h3 class="text-xl font-display text-white mb-4">Команда мирных жителей <span class="text-gray-500 font-normal text-base">(7 игроков)</span></h3>
              <div class="space-y-4 text-gray-300">
                <div>
                  <p class="text-white font-medium">Мирные жители (6 игроков)</p>
                  <p>Не имеют специальных способностей. Голосуют и обсуждают, чтобы вычислить мафию.</p>
                </div>
                <div>
                  <p class="text-white font-medium">Шериф (1 игрок)</p>
                  <p>Каждую ночь проверяет одного игрока. Судья показывает принадлежность: “красный” или “чёрный”.</p>
                </div>
              </div>
            </div>

            <p class="text-gray-500 text-sm">
              В спортивной мафии используются только эти роли. Дополнительных ролей нет.
            </p>
          </div>
        </article>

        <!-- 3. Night Phase -->
        <article id="night" class="scroll-mt-24">
          <div class="rule-header">
            <span class="rule-index">03</span>
            <h2 class="text-2xl md:text-3xl font-display text-white">Ночная фаза</h2>
          </div>
          <div class="rule-content">
            <p>
              Игра начинается с ночи. Судья объявляет “наступает ночь”, игроки надевают маски. Ночью говорить нельзя.
            </p>
            <p>
              Во время ночи все молчат, сидят спокойно и не жестикулируют. Маска должна полностью закрывать глаза.
            </p>
            <p>
              Роли игрока при выбывании не раскрываются. Каждый покинувший игру получает минуту последнего слова.
            </p>

            <div class="space-y-4 mt-6">
              <div class="phase-item phase-mafia">
                <p class="text-white font-medium">Первая ночь: знакомство мафии</p>
                <p>“Чёрные” открывают глаза, знакомятся друг с другом, Дон показывает себя и назначает порядок “отстрела”.</p>
              </div>

              <div class="phase-item phase-mafia">
                <p class="text-white font-medium">Дон просыпается</p>
                <p>Дон показывает номер игрока, которого считает Шерифом. Судья подтверждает или отрицает жестом.</p>
              </div>

              <div class="phase-item phase-civilian">
                <p class="text-white font-medium">Шериф просыпается</p>
                <p>Шериф показывает номер игрока для проверки. Судья показывает “красный” или “чёрный”.</p>
              </div>
            </div>

            <p class="text-gray-500 text-sm mt-6">
              После первой ночи мафия начинает “стрелять”. Если “чёрные” выбрали одного и того же игрока, он покидает игру.
            </p>
          </div>
        </article>

        <!-- 4. Day Discussion -->
        <article id="day" class="scroll-mt-24">
          <div class="rule-header">
            <span class="rule-index">04</span>
            <h2 class="text-2xl md:text-3xl font-display text-white">Дневное обсуждение</h2>
          </div>
          <div class="rule-content">
            <p>
              Судья объявляет утро и сообщает, кто покинул игру этой ночью. Покинувший игрок получает минуту последнего слова.
            </p>

            <div class="space-y-4 mt-6">
              <div>
                <p class="text-white font-medium">Порядок выступлений</p>
                <p>Игроки выступают строго по очереди по номерам. Каждому отводится 1 минута.</p>
              </div>

              <div>
                <p class="text-white font-medium">Выдвижение кандидатур</p>
                <p>Во время своей речи игрок может выдвинуть <strong class="text-white">только одного</strong> кандидата на голосование.</p>
              </div>
              <div>
                <p class="text-white font-medium">Дисциплина речи</p>
                <p>Говорит только тот, кому дали слово. Остальные слушают и не перебивают.</p>
              </div>
            </div>
          </div>
        </article>

        <!-- 4.1 Tips -->
        <article id="tips" class="scroll-mt-24">
          <div class="rule-header">
            <span class="rule-index">04</span>
            <h2 class="text-2xl md:text-3xl font-display text-white">Как говорить в свою минуту</h2>
          </div>
          <div class="rule-content">
            <p>Короткий план, чтобы звучать уверенно:</p>
            <ol class="list-decimal pl-5 space-y-2">
              <li>Скажи, кого считаешь “красным”, а кого — “чёрным”, и почему.</li>
              <li>Отметь 1–2 наблюдения: голосования, реакции, логические несостыковки.</li>
              <li>Назови одного кандидата на голосование и кратко обоснуй выбор.</li>
              <li>Заканчивай фразой “ПАС” или “СПАСИБО”.</li>
            </ol>
          </div>
        </article>

        <!-- 5. Voting -->
        <article id="voting" class="scroll-mt-24">
          <div class="rule-header">
            <span class="rule-index">05</span>
            <h2 class="text-2xl md:text-3xl font-display text-white">Голосование</h2>
          </div>
          <div class="rule-content">
            <p>
              После завершения всех выступлений проводится голосование по выдвинутым кандидатам.
            </p>

            <div class="space-y-4 mt-6">
              <div>
                <p class="text-white font-medium">Процедура голосования</p>
                <p>Голосование открытое. Кандидаты голосуются в порядке выдвижения. Каждый игрок голосует один раз.</p>
              </div>

              <div>
                <p class="text-white font-medium">Обязательное голосование</p>
                <p>Если игрок не проголосовал — его голос засчитывается за последнего в списке.</p>
              </div>

              <div>
                <p class="text-white font-medium">Результат</p>
                <p>Выбывает игрок, набравший большинство голосов. При равенстве — перестрелка.</p>
              </div>
            </div>
          </div>
        </article>

        <!-- 6. Tiebreaker -->
        <article id="tiebreaker" class="scroll-mt-24">
          <div class="rule-header">
            <span class="rule-index">06</span>
            <h2 class="text-2xl md:text-3xl font-display text-white">Перестрелка</h2>
          </div>
          <div class="rule-content">
            <p>
              Перестрелка проводится при равенстве голосов между двумя или более кандидатами.
            </p>

            <div class="space-y-4 mt-6">
              <div>
                <p class="text-white font-medium">Оправдательная речь</p>
                <p>Каждый участник перестрелки получает 30 секунд для оправдательной речи.</p>
              </div>

              <div>
                <p class="text-white font-medium">Повторное равенство</p>
                <p>Если голоса снова поровну, Судья объявляет дополнительное голосование. Далее решение принимает стол по объявлению Судьи.</p>
              </div>
            </div>
          </div>
        </article>

        <!-- 7. Endgame -->
        <article id="endgame" class="scroll-mt-24">
          <div class="rule-header">
            <span class="rule-index">07</span>
            <h2 class="text-2xl md:text-3xl font-display text-white">Условия победы</h2>
          </div>
          <div class="rule-content">
            <div class="grid md:grid-cols-2 gap-6 mt-6">
              <div class="win-card win-mafia">
                <p class="text-blue-400 font-display text-xl mb-3">Победа мафии</p>
                <p class="text-gray-300">Число “чёрных” стало равно или больше числа “красных”.</p>
              </div>

              <div class="win-card win-civilian">
                <p class="text-red-400 font-display text-xl mb-3">Победа мирных</p>
                <p class="text-gray-300">Все три мафиози выбыли из игры.</p>
              </div>
            </div>

            <p class="text-gray-500 text-sm mt-6">
              Победа фиксируется сразу при выполнении условия, независимо от фазы игры.
            </p>
          </div>
        </article>

      </div>
    </div>
  </section>
</BaseLayout>

<style>
  .rules-header {
    background: linear-gradient(180deg, rgba(12, 12, 12, 0.6), rgba(0, 0, 0, 0));
  }

  .rules-header.section-edge::after {
    opacity: 0.3;
  }

  .rule-header {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 1rem;
    align-items: center;
    margin-bottom: 1.5rem;
  }

  .rule-index {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 9999px;
    background: rgba(227, 67, 67, 0.12);
    color: rgba(255, 255, 255, 0.85);
    font-size: 0.85rem;
    font-weight: 600;
  }

  .rule-content {
    color: #c7c7c7;
    line-height: 1.75;
  }

  .rule-content p {
    margin-bottom: 1rem;
  }

  .rule-content p:last-child {
    margin-bottom: 0;
  }

  .team-card {
    padding: 1.5rem;
    border-radius: 1rem;
    background: rgba(255, 255, 255, 0.02);
  }

  .team-mafia {
    border-left: 3px solid rgba(96, 165, 250, 0.4);
  }

  .team-civilian {
    border-left: 3px solid rgba(248, 113, 113, 0.4);
  }

  .phase-item {
    padding-left: 1rem;
    border-left: 2px solid rgba(255, 255, 255, 0.1);
    color: #c7c7c7;
  }

  .phase-mafia {
    border-left-color: rgba(96, 165, 250, 0.35);
  }

  .phase-civilian {
    border-left-color: rgba(248, 113, 113, 0.35);
  }

  .win-card {
    padding: 1.25rem;
    border-radius: 0.75rem;
    background: rgba(255, 255, 255, 0.02);
  }

  .win-mafia {
    border-left: 3px solid rgba(96, 165, 250, 0.4);
  }

  .win-civilian {
    border-left: 3px solid rgba(248, 113, 113, 0.4);
  }
</style>
